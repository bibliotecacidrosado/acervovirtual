<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biblioteca Virtual - GitHub Pages + Google Sheets</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --cor-primaria: #FF6D00;
            --cor-secundaria: #FF9100;
            --cor-terciaria: #FFAB40;
            --cor-fundo: #FFF3E0;
            --cor-texto: #333;
            --cor-texto-claro: #666;
            --sombra: 0 3px 10px rgba(0,0,0,0.1);
            --transicao: all 0.3s ease;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--cor-fundo);
            color: var(--cor-texto);
            line-height: 1.6;
            padding: 0;
            margin: 0;
        }
        
        .header {
            background: linear-gradient(135deg, var(--cor-primaria), var(--cor-secundaria));
            color: white;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        
        .header h1 {
            font-weight: 500;
            font-size: 2.5rem;
        }
        
        .header p {
            font-weight: 300;
            margin-top: 0.5rem;
            opacity: 0.9;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1.5rem 3rem;
        }
        
        .controles {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: center;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: white;
            border-radius: 10px;
            box-shadow: var(--sombra);
        }
        
        .controles input, .controles select {
            padding: 0.8rem 1.2rem;
            border-radius: 6px;
            border: 1px solid #ddd;
            background-color: white;
            font-family: 'Roboto', sans-serif;
            font-size: 1rem;
            min-width: 250px;
            transition: var(--transicao);
        }
        
        .controles input:focus, .controles select:focus {
            outline: none;
            border-color: var(--cor-primaria);
            box-shadow: 0 0 0 2px rgba(255, 109, 0, 0.2);
        }
        
        .info-box {
            background-color: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-radius: 4px;
        }
        
        .info-box h3 {
            color: #2e7d32;
            margin-bottom: 0.5rem;
        }
        
        .estatisticas {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        
        .estatistica-item {
            background: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            text-align: center;
            box-shadow: var(--sombra);
            min-width: 150px;
        }
        
        .estatistica-valor {
            font-size: 1.8rem;
            font-weight: 500;
            color: var(--cor-primaria);
        }
        
        .estatistica-label {
            font-size: 0.9rem;
            color: var(--cor-texto-claro);
        }
        
        .grid-livros {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .card-livro {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--sombra);
            transition: var(--transicao);
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .card-livro:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }
        
        .card-capa {
            width: 100%;
            height: 220px;
            object-fit: contain;
            background-color: #f9f9f9;
            padding: 1rem;
        }
        
        .card-corpo {
            padding: 1.5rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        
        .card-titulo {
            font-weight: 500;
            margin: 0 0 0.5rem 0;
            color: var(--cor-primaria);
            font-size: 1.2rem;
            line-height: 1.3;
        }
        
        .card-autor {
            color: var(--cor-texto-claro);
            font-size: 0.95rem;
            margin: 0 0 1rem 0;
        }
        
        .card-categoria {
            display: inline-block;
            background-color: var(--cor-terciaria);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            margin-bottom: 1.2rem;
            align-self: flex-start;
        }
        
        .card-botao {
            text-align: center;
            background-color: var(--cor-primaria);
            color: white;
            padding: 0.8rem;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 500;
            transition: var(--transicao);
            margin-top: auto;
        }
        
        .card-botao:hover {
            background-color: var(--cor-secundaria);
        }
        
        .sem-resultados {
            text-align: center;
            padding: 3rem;
            grid-column: 1 / -1;
            background: white;
            border-radius: 10px;
            box-shadow: var(--sombra);
        }
        
        .loading {
            text-align: center;
            padding: 3rem;
            grid-column: 1 / -1;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 109, 0, 0.2);
            border-radius: 50%;
            border-top-color: var(--cor-primaria);
            animation: spin 1s ease-in-out infinite;
        }
        
        .controles-paginacao {
            display: none;
            justify-content: center;
            align-items: center;
            margin-top: 30px;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .btn-paginacao {
            padding: 8px 16px;
            background-color: var(--cor-primaria);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transicao);
        }
        
        .btn-paginacao:hover:not(:disabled) {
            background-color: var(--cor-secundaria);
        }
        
        .btn-paginacao:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        .info-paginacao {
            font-weight: 500;
            margin: 0 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .footer {
            text-align: center;
            padding: 2rem;
            margin-top: 3rem;
            color: var(--cor-texto-claro);
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .controles {
                flex-direction: column;
            }
            
            .controles input, .controles select {
                min-width: auto;
                width: 100%;
            }
            
            .grid-livros {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            .controles-paginacao {
                flex-direction: column;
                gap: 10px;
            }
        }
        
        @media (max-width: 480px) {
            .grid-livros {
                grid-template-columns: 1fr;
            }
            
            .estatisticas {
                flex-direction: column;
                align-items: center;
            }
            
            .estatistica-item {
                width: 100%;
                max-width: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Biblioteca Digital Cid Rosado</h1>
        <p>Obras em dom√≠nio p√∫blico e publica√ß√µes de acesso gratuito dispon√≠veis para consulta e download legal.</p>
    </div>
    
    <div class="container">
        <div class="info-box">
            <h3>üöÄ Biblioteca no GitHub Pages</h3>
            <p>Hospedagem est√°vel + Dados em tempo real do Google Sheets</p>
        </div>
        
        <div class="controles">
            <input type="text" id="busca" placeholder="Buscar por t√≠tulo ou autor..." onkeyup="filtrarLivros()">
            <select id="filtro-categoria" onchange="filtrarLivros()">
                <option value="">Todas as categorias</option>
            </select>
        </div>
        
        <div class="estatisticas">
            <div class="estatistica-item">
                <div class="estatistica-valor" id="total-livros">0</div>
                <div class="estatistica-label">Livros no total</div>
            </div>
            <div class="estatistica-item">
                <div class="estatistica-valor" id="livros-visiveis">0</div>
                <div class="estatistica-label">Livros encontrados</div>
            </div>
            <div class="estatistica-item">
                <div class="estatistica-valor" id="total-categorias">0</div>
                <div class="estatistica-label">Categorias</div>
            </div>
        </div>
        
        <div class="grid-livros" id="livros-container">
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Carregando livros...</p>
            </div>
        </div>
        
        <div class="controles-paginacao" id="controles-paginacao">
            <button class="btn-paginacao" id="pagina-anterior" onclick="paginaAnterior()">Anterior</button>
            <span class="info-paginacao" id="pagina-atual">P√°gina 1 de 1</span>
            <button class="btn-paginacao" id="proxima-pagina" onclick="proximaPagina()">Pr√≥xima</button>
        </div>
    </div>
    
    <div class="footer">
        <p>Biblioteca Virtual &copy; 2025 - GitHub Pages + Google Sheets</p>
    </div>

    <script>
        // Vari√°veis globais
        let todosLivros = [];
        let livrosFiltrados = [];
        let categoriasUnicas = new Set();
        let paginaAtual = 1;
        const livrosPorPagina = 10;
        
        // Configura√ß√µes da planilha
        const PLANILHA_ID = '1HfygQJLmisPNyjeMrQi8y-WK8Xb5DazE1gKUl67AI3Y';
        const ABA_NOME = 'P√°gina1';
        
        // Carregar dados quando a p√°gina for carregada
        document.addEventListener('DOMContentLoaded', function() {
            carregarLivrosDaPlanilha();
        });
        
        // Fun√ß√£o para carregar dados diretamente do Google Sheets
        async function carregarLivrosDaPlanilha() {
            try {
                // Usando o servi√ßo opensheet.elk.sh para acessar a planilha
                const url = `https://opensheet.elk.sh/${PLANILHA_ID}/${ABA_NOME}`;
                
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error('Erro ao carregar dados da planilha');
                }
                
                const dadosBrutos = await response.json();
                const livros = processarDadosPlanilha(dadosBrutos);
                
                processarLivros(livros);
            } catch (error) {
                mostrarErro(error);
            }
        }
        
        // Processar dados brutos da planilha para o formato desejado
        function processarDadosPlanilha(dadosBrutos) {
            return dadosBrutos
                .filter(row => row.Col2 && row.Col2.toString().trim() !== '') // Filtrar linhas vazias
                .map(row => {
                    const linkCapa = row.Col6; // Coluna F
                    let idDrive = '';
                    
                    // Extrair ID do Google Drive do link da capa
                    if (linkCapa && typeof linkCapa === 'string') {
                        const match1 = linkCapa.match(/\/open\?id=([^&]+)/);
                        const match2 = linkCapa.match(/\/file\/d\/([^\/]+)/);
                        
                        if (match1 && match1[1]) idDrive = match1[1];
                        else if (match2 && match2[1]) idDrive = match2[1];
                    }
                    
                    return {
                        titulo: row.Col2 || 'T√≠tulo n√£o dispon√≠vel',
                        autor: row.Col3 || 'Autor desconhecido',
                        categoria: row.Col4 || '',
                        link: row.Col5 || '#',
                        capa: idDrive 
                            ? `https://drive.google.com/thumbnail?id=${idDrive}&sz=w400`
                            : 'https://via.placeholder.com/200x300?text=Sem+Capa'
                    };
                });
        }
        
        // Processar livros recebidos
        function processarLivros(livros) {
            todosLivros = livros;
            livrosFiltrados = [...livros];
            
            // Coletar categorias √∫nicas
            categoriasUnicas.clear();
            livros.forEach(livro => {
                if (livro.categoria) {
                    categoriasUnicas.add(livro.categoria);
                }
            });
            
            // Atualizar estat√≠sticas
            atualizarEstatisticas();
            
            // Preencher dropdown de categorias
            preencherDropdownCategorias();
            
            // Exibir livros
            exibirLivros();
        }
        
        // Mostrar erro
        function mostrarErro(error) {
            console.error('Erro:', error);
            document.getElementById('livros-container').innerHTML = `
                <div class="sem-resultados">
                    <h3>Erro ao carregar os dados</h3>
                    <p>${error.message || error}</p>
                    <p>Verifique se a planilha est√° p√∫blica</p>
                    <button onclick="carregarLivrosDaPlanilha()" style="margin-top: 1rem; padding: 0.5rem 1.5rem; background: var(--cor-primaria); color: white; border: none; border-radius: 4px; cursor: pointer;">Tentar Novamente</button>
                </div>
            `;
        }
        
        // Preencher dropdown de categorias
        function preencherDropdownCategorias() {
            const select = document.getElementById('filtro-categoria');
            select.innerHTML = '<option value="">Todas as categorias</option>';
            
            // Ordenar categorias alfabeticamente
            const categoriasOrdenadas = Array.from(categoriasUnicas).sort();
            
            categoriasOrdenadas.forEach(categoria => {
                const option = document.createElement('option');
                option.value = categoria;
                option.textContent = categoria;
                select.appendChild(option);
            });
        }
        
        // Exibir livros na tela com pagina√ß√£o
        function exibirLivros() {
            const container = document.getElementById('livros-container');
            const controlesPaginacao = document.getElementById('controles-paginacao');
            
            if (livrosFiltrados.length === 0) {
                container.innerHTML = `
                    <div class="sem-resultados">
                        <h3>Nenhum livro encontrado</h3>
                        <p>Tente ajustar os filtros de busca.</p>
                    </div>
                `;
                controlesPaginacao.style.display = 'none';
                return;
            }
            
            // Calcular √≠ndices para a p√°gina atual
            const indiceInicio = (paginaAtual - 1) * livrosPorPagina;
            const indiceFim = indiceInicio + livrosPorPagina;
            const livrosPagina = livrosFiltrados.slice(indiceInicio, indiceFim);
            
            container.innerHTML = '';
            
            livrosPagina.forEach(livro => {
                const card = document.createElement('div');
                card.className = 'card-livro';
                card.innerHTML = `
                    <img src="${livro.capa}" alt="Capa do livro ${livro.titulo}" class="card-capa"
                         onerror="this.src='https://via.placeholder.com/200x300?text=Imagem+N√£o+Encontrada'">
                    <div class="card-corpo">
                        <h3 class="card-titulo">${livro.titulo}</h3>
                        <p class="card-autor">${livro.autor}</p>
                        ${livro.categoria ? `<span class="card-categoria">${livro.categoria}</span>` : ''}
                        <a href="${livro.link}" target="_blank" class="card-botao">Acessar Livro</a>
                    </div>
                `;
                container.appendChild(card);
            });
            
            // Atualizar controles de pagina√ß√£o
            atualizarControlesPaginacao();
        }
        
        // Atualizar controles de pagina√ß√£o
        function atualizarControlesPaginacao() {
            const controlesPaginacao = document.getElementById('controles-paginacao');
            const totalPaginas = Math.ceil(livrosFiltrados.length / livrosPorPagina);
            
            if (livrosFiltrados.length <= livrosPorPagina) {
                controlesPaginacao.style.display = 'none';
                return;
            }
            
            controlesPaginacao.style.display = 'flex';
            document.getElementById('pagina-atual').textContent = `P√°gina ${paginaAtual} de ${totalPaginas}`;
            
            // Habilitar/desabilitar bot√µes
            document.getElementById('pagina-anterior').disabled = (paginaAtual === 1);
            document.getElementById('proxima-pagina').disabled = (paginaAtual === totalPaginas);
        }
        
        // Ir para p√°gina anterior
        function paginaAnterior() {
            if (paginaAtual > 1) {
                paginaAtual--;
                exibirLivros();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }
        
        // Ir para pr√≥xima p√°gina
        function proximaPagina() {
            const totalPaginas = Math.ceil(livrosFiltrados.length / livrosPorPagina);
            if (paginaAtual < totalPaginas) {
                paginaAtual++;
                exibirLivros();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }
        
        // Filtrar livros com base nos crit√©rios de busca
        function filtrarLivros() {
            const termoBusca = document.getElementById('busca').value.toLowerCase();
            const categoriaSelecionada = document.getElementById('filtro-categoria').value;
            
            // Resetar para a primeira p√°gina ao filtrar
            paginaAtual = 1;
            
            livrosFiltrados = todosLivros.filter(livro => {
                const correspondeBusca = !termoBusca || 
                    livro.titulo.toLowerCase().includes(termoBusca) || 
                    livro.autor.toLowerCase().includes(termoBusca);
                
                const correspondeCategoria = !categoriaSelecionada || 
                    livro.categoria === categoriaSelecionada;
                
                return correspondeBusca && correspondeCategoria;
            });
            
            // Atualizar estat√≠sticas
            atualizarEstatisticas();
            
            // Exibir livros filtrados
            exibirLivros();
        }
        
        // Atualizar estat√≠sticas
        function atualizarEstatisticas() {
            document.getElementById('total-livros').textContent = todosLivros.length;
            document.getElementById('livros-visiveis').textContent = livrosFiltrados.length;
            document.getElementById('total-categorias').textContent = categoriasUnicas.size;
        }
        
        // Fun√ß√£o para for√ßar atualiza√ß√£o dos dados
        function atualizarDados() {
            document.getElementById('livros-container').innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Atualizando dados...</p>
                </div>
            `;
            carregarLivrosDaPlanilha();
        }
    </script>
</body>
</html>